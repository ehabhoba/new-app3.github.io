<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GM Online Services Egypt</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #e0eafc, #cfdef3);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .ltr {
      font-family: 'Inter', sans-serif;
      direction: ltr;
      text-align: left;
    }
    .rtl {
      font-family: 'Cairo', sans-serif;
      direction: rtl;
      text-align: right;
    }
    .error {
      border-color: #ef4444 !important;
    }
    .error-message {
      color: #ef4444;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }
    .tooltip {
      position: relative;
      display: inline-block;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: #555;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      right: 50%;
      transform: translateX(50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    .navbar {
      background: linear-gradient(90deg, #3b82f6, #1d4ed8);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .navbar a {
      transition: all 0.3s ease;
    }
    .navbar a:hover {
      background-color: #2563eb;
      border-radius: 5px;
    }
    .hero-section {
      background: url('https://source.unsplash.com/1600x400/?education,research') no-repeat center center/cover;
      color: white;
      text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.5);
    }
    .form-section, .instructions-section, .track-section, .verification-section {
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    .btn-primary {
      background: linear-gradient(90deg, #3b82f6, #1d4ed8);
      transition: transform 0.2s ease;
    }
    .btn-primary:hover {
      transform: scale(1.05);
    }
    footer {
      background: #1f2937;
      color: white;
      margin-top: auto;
    }
  </style>
</head>
<body class="rtl">
  <!-- Navigation Bar -->
  <nav class="navbar p-4">
    <div class="container mx-auto flex justify-between items-center">
      <a href="#home" class="text-white text-2xl font-bold">GM Online Services Egypt</a>
      <div class="space-x-4">
        <a href="#home" class="text-white px-3 py-2">الرئيسية</a>
        <a href="#instructions" class="text-white px-3 py-2">تعليمات الاستخدام</a>
        <a href="#track" class="text-white px-3 py-2">تتبع الطلب</a>
        <a href="#contact" class="text-white px-3 py-2">اتصل بنا</a>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section id="home" class="hero-section py-16 text-center">
    <div class="container mx-auto">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">GM Online Services Egypt</h1>
      <p class="text-lg md:text-xl mb-6">اطلب خدمتك البحثية بسهولة وسرعة، وتابع حالة طلبك في أي وقت!</p>
      <a href="#form" class="btn-primary text-white px-6 py-3 rounded-lg text-lg">اطلب الآن</a>
    </div>
  </section>

  <!-- Form Section -->
  <section id="form" class="py-12">
    <div class="container mx-auto px-4">
      <div class="form-section p-8 max-w-lg mx-auto">
        <h2 id="title" class="text-2xl font-bold text-gray-800 mb-6 text-center">طلب خدمة بحث مخصص</h2>
        <div class="space-y-5">
          <div>
            <label for="studentName" id="studentNameLabel" class="block text-sm font-medium text-gray-700 mb-1">اسم الطالب:</label>
            <div class="relative">
              <input type="text" id="studentName" required placeholder="أدخل اسمك" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 pl-10">
              <i class="fas fa-user absolute right-3 top-3 h-5 w-5 text-gray-400"></i>
            </div>
            <p id="studentNameError" class="error-message hidden">اكتب اسمك لو سمحت!</p>
          </div>

          <div>
            <label for="studentPhone" id="studentPhoneLabel" class="block text-sm font-medium text-gray-700 mb-1">رقم الهاتف:</label>
            <div class="relative">
              <input type="tel" id="studentPhone" required placeholder="أدخل رقم هاتفك" pattern="[0-9]{10,15}" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 pl-10">
              <i class="fas fa-phone absolute right-3 top-3 h-5 w-5 text-gray-400"></i>
            </div>
            <p id="studentPhoneError" class="error-message hidden">رقم الهاتف لازم يكون صحيح!</p>
          </div>

          <div>
            <label for="researchTitle" id="researchTitleLabel" class="block text-sm font-medium text-gray-700 mb-1">عنوان البحث:</label>
            <div class="relative">
              <input type="text" id="researchTitle" required placeholder="أدخل عنوان البحث" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 pl-10">
              <i class="fas fa-book absolute right-3 top-3 h-5 w-5 text-gray-400"></i>
            </div>
            <p id="researchTitleError" class="error-message hidden">اكتب عنوان البحث لو سمحت!</p>
          </div>

          <div>
            <label for="stage" id="stageLabel" class="block text-sm font-medium text-gray-700 mb-1">المرحلة الدراسية:</label>
            <div class="relative">
              <select id="stage" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 pl-10" required>
                <option value="">اختر المرحلة</option>
                <option value="primary">الابتدائي</option>
                <option value="preparatory">الإعدادي</option>
                <option value="secondary">الثانوي</option>
                <option value="university">الجامعي</option>
                <option value="postgraduate">الدراسات العليا</option>
              </select>
              <i class="fas fa-graduation-cap absolute right-3 top-3 h-5 w-5 text-gray-400"></i>
            </div>
            <p id="stageError" class="error-message hidden">اختار المرحلة لو سمحت!</p>
          </div>

          <div>
            <label for="researchType" id="researchTypeLabel" class="block text-sm font-medium text-gray-700 mb-1">نوع البحث:</label>
            <div class="relative">
              <select id="researchType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 pl-10" required>
                <option value="">اختر نوع البحث</option>
                <option value="school_report">تقرير مدرسي</option>
                <option value="secondary_research">بحث ثانوي</option>
                <option value="university_research">بحث جامعي</option>
                <option value="thesis">أطروحة</option>
              </select>
              <i class="fas fa-file-alt absolute right-3 top-3 h-5 w-5 text-gray-400"></i>
            </div>
            <div class="tooltip mt-1">
              <span class="text-xs text-gray-500">اضغط لمعرفة الفرق بين أنواع البحث</span>
              <span class="tooltiptext">
                - تقرير مدرسي: للمشاريع البسيطة (ابتدائي/إعدادي)<br>
                - بحث ثانوي: للطلاب في الثانوية<br>
                - بحث جامعي: للطلاب الجامعيين<br>
                - أطروحة: للدراسات العليا (ماجستير/دكتوراه)
              </span>
            </div>
            <p id="researchTypeError" class="error-message hidden">اختار نوع البحث لو سمحت!</p>
          </div>

          <div>
            <label for="pages" id="pagesLabel" class="block text-sm font-medium text-gray-700 mb-1">عدد الأوراق:</label>
            <div class="relative">
              <input type="number" id="pages" min="1" required placeholder="أدخل عدد الأوراق" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 pl-10">
              <i class="fas fa-file absolute right-3 top-3 h-5 w-5 text-gray-400"></i>
            </div>
            <p id="pagesError" class="error-message hidden">عدد الأوراق لازم يكون أكبر من 0!</p>
          </div>

          <div>
            <label for="deliveryDate" id="deliveryDateLabel" class="block text-sm font-medium text-gray-700 mb-1">تاريخ التسليم:</label>
            <div class="relative">
              <input type="date" id="deliveryDate" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 pl-10">
              <i class="fas fa-calendar-alt absolute right-3 top-3 h-5 w-5 text-gray-400"></i>
            </div>
            <p id="deliveryDateError" class="error-message hidden">اختار تاريخ التسليم لو سمحت!</p>
          </div>

          <div>
            <label for="language" id="languageLabel" class="block text-sm font-medium text-gray-700 mb-1">اللغة:</label>
            <div class="relative">
              <select id="language" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 pl-10" required>
                <option value="arabic">العربية</option>
                <option value="english">الإنجليزية</option>
              </select>
              <i class="fas fa-language absolute right-3 top-3 h-5 w-5 text-gray-400"></i>
            </div>
          </div>

          <button onclick="calculateCost()" id="calculateBtn" class="btn-primary w-full text-white py-3 rounded-lg">احسب التكلفة</button>
          <div id="result" class="text-center text-lg font-semibold text-gray-800"></div>
          <button id="sendWhatsApp" onclick="previewOrder()" class="btn-primary w-full text-white py-3 rounded-lg hidden">إرسال الطلب عبر WhatsApp</button>
        </div>

        <div id="orderPreview" class="hidden mt-6 p-4 bg-gray-100 rounded-lg">
          <h2 id="previewTitle" class="text-lg font-semibold mb-2">معاينة الطلب</h2>
          <p id="previewDetails"></p>
          <div class="flex justify-between mt-4">
            <button onclick="submitOrder()" id="confirmBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">تأكيد الإرسال</button>
            <button onclick="closePreview()" id="cancelBtn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400">إلغاء</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Instructions Section -->
  <section id="instructions" class="py-12 bg-gray-100">
    <div class="container mx-auto px-4">
      <div class="instructions-section p-8 max-w-3xl mx-auto">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">تعليمات استخدام الموقع</h2>
        <div class="space-y-4 text-gray-700">
          <h3 class="text-lg font-semibold">كيفية طلب خدمة بحثية مثالية:</h3>
          <ul class="list-disc pr-6 space-y-2">
            <li>املأ جميع الحقول المطلوبة في النموذج بعناية، مثل اسمك، رقم هاتفك، وعنوان البحث.</li>
            <li>اختر المرحلة الدراسية ونوع البحث المناسب لاحتياجاتك (مثل تقرير مدرسي أو أطروحة).</li>
            <li>حدد عدد الأوراق وتاريخ التسليم بعناية، وتأكد من أن التاريخ ليس في الماضي.</li>
            <li>اختر اللغة المطلوبة للبحث (العربية أو الإنجليزية).</li>
            <li>بعد ملء النموذج، اضغط على "احسب التكلفة" لمعرفة السعر الإجمالي.</li>
            <li>راجع تفاصيل الطلب في قسم المعاينة، ثم اضغط على "تأكيد الإرسال".</li>
            <li>ستتلقى رسالة تأكيد على WhatsApp فور إرسال الطلب، تحتوي على معرف الطلب.</li>
            <li>استخدم معرف الطلب لتتبع حالته من قسم "تتبع الطلب" في الموقع.</li>
          </ul>
          <p class="text-sm text-gray-500">ملاحظة: تأكد من إدخال رقم هاتف صحيح لتلقي التحديثات عبر WhatsApp.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Track Order Section -->
  <section id="track" class="py-12">
    <div class="container mx-auto px-4">
      <div class="track-section p-8 max-w-lg mx-auto">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">تتبع حالة الطلب</h2>
        <div class="space-y-4">
          <div>
            <label for="trackOrderId" class="block text-sm font-medium text-gray-700 mb-1">معرف الطلب:</label>
            <div class="relative">
              <input type="text" id="trackOrderId" placeholder="أدخل معرف الطلب (مثل ORD-...)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 pl-10">
              <i class="fas fa-search absolute right-3 top-3 h-5 w-5 text-gray-400"></i>
            </div>
          </div>
          <button onclick="trackOrder()" class="btn-primary w-full text-white py-3 rounded-lg">تتبع الطلب</button>
          <div id="trackResult" class="text-center text-lg font-semibold text-gray-800 mt-4"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact Section -->
  <section id="contact" class="py-12 bg-gray-100">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">اتصل بنا</h2>
      <p class="text-gray-700 mb-4">للتواصل معنا، يمكنك استخدام الوسائل التالية:</p>
      <div class="flex justify-center space-x-4">
        <a href="https://wa.me/201022679250" target="_blank" class="text-green-600 hover:text-green-800"><i class="fab fa-whatsapp fa-2x"></i></a>
        <a href="mailto:support@gmonlineservices.com" class="text-blue-600 hover:text-blue-800"><i class="fas fa-envelope fa-2x"></i></a>
      </div>
    </div>
  </section>

  <!-- Verification Section -->
  <section id="verification" class="py-12">
    <div class="container mx-auto px-4">
      <div class="verification-section p-8 max-w-lg mx-auto text-center">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">معلومات التوثيق</h2>
        <div class="space-y-4">
          <p><i class="fas fa-envelope text-blue-600"></i> <strong>البريد الإلكتروني الموثق:</strong> ehabgm200@gmail.com <span class="text-green-600">✅</span></p>
          <p><i class="fas fa-link text-blue-600"></i> <strong>الرابط الموثق:</strong> <a href="https://ehabgm.link" target="_blank" class="text-blue-600 underline">ehabgm.link</a> <span class="text-green-600">✅</span></p>
          <p><i class="fas fa-shield-alt text-blue-600"></i> <strong>توثيق الصفحة:</strong> صفحة موثقة رسميًا بواسطة GM Online Services Egypt <span class="text-green-600">✅</span></p>
          <p class="text-sm text-gray-500">تاريخ التوثيق: 19 مايو 2025، الساعة 10:24 مساءً بتوقيت EEST</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="py-6 text-center">
    <p>© 2025 GM Online Services Egypt. جميع الحقوق محفوظة.</p>
    <p class="text-sm">تواصلوا معنا عبر <a href="https://wa.me/201022679250" class="underline">WhatsApp</a> أو البريد الإلكتروني: <a href="mailto:support@gmonlineservices.com" class="underline">support@gmonlineservices.com</a></p>
  </footer>

  <script>
    // Language toggle
    const translations = {
      ar: {
        title: 'طلب خدمة بحث مخصص',
        studentNameLabel: 'اسم الطالب:',
        studentNamePlaceholder: 'أدخل اسمك',
        studentPhoneLabel: 'رقم الهاتف:',
        studentPhonePlaceholder: 'أدخل رقم هاتفك',
        researchTitleLabel: 'عنوان البحث:',
        researchTitlePlaceholder: 'أدخل عنوان البحث',
        stageLabel: 'المرحلة الدراسية:',
        stagePlaceholder: 'اختر المرحلة',
        researchTypeLabel: 'نوع البحث:',
        researchTypePlaceholder: 'اختر نوع البحث',
        pagesLabel: 'عدد الأوراق:',
        pagesPlaceholder: 'أدخل عدد الأوراق',
        deliveryDateLabel: 'تاريخ التسليم:',
        languageLabel: 'اللغة:',
        calculateBtn: 'احسب التكلفة',
        sendWhatsApp: 'إرسال الطلب عبر WhatsApp',
        studentNameError: 'اكتب اسمك لو سمحت!',
        studentPhoneError: 'رقم الهاتف لازم يكون صحيح!',
        researchTitleError: 'اكتب عنوان البحث لو سمحت!',
        stageError: 'اختار المرحلة لو سمحت!',
        researchTypeError: 'اختار نوع البحث لو سمحت!',
        pagesError: 'عدد الأوراق لازم يكون أكبر من 0!',
        deliveryDateError: 'اختار تاريخ التسليم لو سمحت!',
        previewTitle: 'معاينة الطلب',
        confirmBtn: 'تأكيد الإرسال',
        cancelBtn: 'إلغاء'
      },
      en: {
        title: 'Custom Research Request',
        studentNameLabel: 'Student Name:',
        studentNamePlaceholder: 'Enter your name',
        studentPhoneLabel: 'Phone Number:',
        studentPhonePlaceholder: 'Enter your phone number',
        researchTitleLabel: 'Research Title:',
        researchTitlePlaceholder: 'Enter research title',
        stageLabel: 'Academic Level:',
        stagePlaceholder: 'Select level',
        researchTypeLabel: 'Research Type:',
        researchTypePlaceholder: 'Select research type',
        pagesLabel: 'Number of Pages:',
        pagesPlaceholder: 'Enter number of pages',
        deliveryDateLabel: 'Delivery Date:',
        languageLabel: 'Language:',
        calculateBtn: 'Calculate Cost',
        sendWhatsApp: 'Send Request via WhatsApp',
        studentNameError: 'Please enter your name!',
        studentPhoneError: 'Please enter a valid phone number!',
        researchTitleError: 'Please enter the research title!',
        stageError: 'Please select an academic level!',
        researchTypeError: 'Please select a research type!',
        pagesError: 'Number of pages must be greater than 0!',
        deliveryDateError: 'Please select a delivery date!',
        previewTitle: 'Order Preview',
        confirmBtn: 'Confirm Send',
        cancelBtn: 'Cancel'
      }
    };

    let currentLang = 'ar';

    function updateLanguage() {
      const t = translations[currentLang];
      document.getElementById('title').textContent = t.title;
      document.getElementById('studentNameLabel').textContent = t.studentNameLabel;
      document.getElementById('studentPhoneLabel').textContent = t.studentPhoneLabel;
      document.getElementById('researchTitleLabel').textContent = t.researchTitleLabel;
      document.getElementById('stageLabel').textContent = t.stageLabel;
      document.getElementById('researchTypeLabel').textContent = t.researchTypeLabel;
      document.getElementById('pagesLabel').textContent = t.pagesLabel;
      document.getElementById('deliveryDateLabel').textContent = t.deliveryDateLabel;
      document.getElementById('languageLabel').textContent = t.languageLabel;
      document.getElementById('calculateBtn').textContent = t.calculateBtn;
      document.getElementById('sendWhatsApp').textContent = t.sendWhatsApp;
      document.getElementById('previewTitle').textContent = t.previewTitle;
      document.getElementById('confirmBtn').textContent = t.confirmBtn;
      document.getElementById('cancelBtn').textContent = t.cancelBtn;

      document.getElementById('studentName').placeholder = t.studentNamePlaceholder;
      document.getElementById('studentPhone').placeholder = t.studentPhonePlaceholder;
      document.getElementById('researchTitle').placeholder = t.researchTitlePlaceholder;
      document.getElementById('stage').options[0].textContent = t.stagePlaceholder;
      document.getElementById('researchType').options[0].textContent = t.researchTypePlaceholder;
      document.getElementById('pages').placeholder = t.pagesPlaceholder;
      document.body.classList.remove(currentLang === 'ar' ? 'ltr' : 'rtl');
      document.body.classList.add(currentLang === 'ar' ? 'rtl' : 'ltr');
    }

    // Form validation
    function validateForm() {
      let isValid = true;
      const studentName = document.getElementById('studentName');
      const studentPhone = document.getElementById('studentPhone');
      const researchTitle = document.getElementById('researchTitle');
      const stage = document.getElementById('stage');
      const researchType = document.getElementById('researchType');
      const pages = document.getElementById('pages');
      const deliveryDate = document.getElementById('deliveryDate');
      const t = translations[currentLang];

      // Reset errors
      studentName.classList.remove('error');
      studentPhone.classList.remove('error');
      researchTitle.classList.remove('error');
      stage.classList.remove('error');
      researchType.classList.remove('error');
      pages.classList.remove('error');
      deliveryDate.classList.remove('error');
      document.getElementById('studentNameError').classList.add('hidden');
      document.getElementById('studentPhoneError').classList.add('hidden');
      document.getElementById('researchTitleError').classList.add('hidden');
      document.getElementById('stageError').classList.add('hidden');
      document.getElementById('researchTypeError').classList.add('hidden');
      document.getElementById('pagesError').classList.add('hidden');
      document.getElementById('deliveryDateError').classList.add('hidden');

      // Validate student name
      if (!studentName.value.trim()) {
        studentName.classList.add('error');
        document.getElementById('studentNameError').textContent = t.studentNameError;
        document.getElementById('studentNameError').classList.remove('hidden');
        isValid = false;
      }

      // Validate student phone
      const phonePattern = /^[0-9]{10,15}$/;
      if (!phonePattern.test(studentPhone.value.trim())) {
        studentPhone.classList.add('error');
        document.getElementById('studentPhoneError').textContent = t.studentPhoneError;
        document.getElementById('studentPhoneError').classList.remove('hidden');
        isValid = false;
      }

      // Validate research title
      if (!researchTitle.value.trim()) {
        researchTitle.classList.add('error');
        document.getElementById('researchTitleError').textContent = t.researchTitleError;
        document.getElementById('researchTitleError').classList.remove('hidden');
        isValid = false;
      }

      // Validate stage
      if (!stage.value) {
        stage.classList.add('error');
        document.getElementById('stageError').textContent = t.stageError;
        document.getElementById('stageError').classList.remove('hidden');
        isValid = false;
      }

      // Validate research type
      if (!researchType.value) {
        researchType.classList.add('error');
        document.getElementById('researchTypeError').textContent = t.researchTypeError;
        document.getElementById('researchTypeError').classList.remove('hidden');
        isValid = false;
      }

      // Validate pages
      const pagesValue = parseInt(pages.value);
      if (!pagesValue || pagesValue < 1) {
        pages.classList.add('error');
        document.getElementById('pagesError').textContent = t.pagesError;
        document.getElementById('pagesError').classList.remove('hidden');
        isValid = false;
      }

      // Validate delivery date
      const today = new Date('2025-05-19').toISOString().split('T')[0];
      if (!deliveryDate.value || deliveryDate.value < today) {
        deliveryDate.classList.add('error');
        document.getElementById('deliveryDateError').textContent = t.deliveryDateError;
        document.getElementById('deliveryDateError').classList.remove('hidden');
        isValid = false;
      }

      return isValid;
    }

    let calculatedCost = 0;
    let orderDetails = {};

    function calculateCost() {
      if (!validateForm()) {
        document.getElementById('result').innerHTML = `<span class="text-red-500">${translations[currentLang].pagesError}</span>`;
        document.getElementById('sendWhatsApp').classList.add('hidden');
        return;
      }

      const studentName = document.getElementById('studentName').value.trim();
      const studentPhone = document.getElementById('studentPhone').value.trim();
      const researchTitle = document.getElementById('researchTitle').value.trim();
      const stage = document.getElementById('stage').value;
      const researchType = document.getElementById('researchType').value;
      const pages = parseInt(document.getElementById('pages').value);
      const deliveryDate = document.getElementById('deliveryDate').value;
      const language = document.getElementById('language').value;

      // Calculate cost
      const basePricePerPage = 50;
      let typeMultiplier = 1;
      if (researchType === 'secondary_research') typeMultiplier = 1.2;
      else if (researchType === 'university_research') typeMultiplier = 1.5;
      else if (researchType === 'thesis') typeMultiplier = 2;

      calculatedCost = pages * basePricePerPage * typeMultiplier;
      if (language === 'english') calculatedCost *= 1.2;

      // Display result
      document.getElementById('result').innerHTML = `${translations[currentLang].calculateBtn}: ${calculatedCost.toFixed(2)} EGP`;
      document.getElementById('sendWhatsApp').classList.remove('hidden');

      // Store order details
      orderDetails = {
        studentName,
        studentPhone,
        researchTitle,
        stage,
        researchType,
        pages,
        deliveryDate,
        language,
        cost: calculatedCost,
        timestamp: new Date().toISOString(),
        status: 'قيد المعالجة' // Initial status
      };
    }

    function previewOrder() {
      const { studentName, studentPhone, researchTitle, stage, researchType, pages, deliveryDate, language, cost } = orderDetails;
      const stageText = document.querySelector(`#stage option[value="${stage}"]`).textContent;
      const researchTypeText = document.querySelector(`#researchType option[value="${researchType}"]`).textContent;
      const languageText = document.querySelector(`#language option[value="${language}"]`).textContent;

      const orderId = `ORD-${Date.now()}`;
      orderDetails.orderId = orderId; // Store orderId in orderDetails

      const previewText = `
        ${currentLang === 'ar' ? 'معرف الطلب' : 'Order ID'}: ${orderId}<br>
        ${translations[currentLang].studentNameLabel} ${studentName}<br>
        ${translations[currentLang].studentPhoneLabel} ${studentPhone}<br>
        ${translations[currentLang].researchTitleLabel} ${researchTitle}<br>
        ${translations[currentLang].stageLabel} ${stageText}<br>
        ${translations[currentLang].researchTypeLabel} ${researchTypeText}<br>
        ${translations[currentLang].pagesLabel} ${pages}<br>
        ${translations[currentLang].deliveryDateLabel} ${deliveryDate}<br>
        ${translations[currentLang].languageLabel} ${languageText}<br>
        ${translations[currentLang].calculateBtn}: ${cost.toFixed(2)} EGP
      `;

      document.getElementById('previewDetails').innerHTML = previewText;
      document.getElementById('orderPreview').classList.remove('hidden');
    }

    function closePreview() {
      document.getElementById('orderPreview').classList.add('hidden');
    }

    async function submitOrder() {
      const { studentName, studentPhone, researchTitle, stage, researchType, pages, deliveryDate, language, cost, orderId } = orderDetails;
      const stageText = document.querySelector(`#stage option[value="${stage}"]`).textContent;
      const researchTypeText = document.querySelector(`#researchType option[value="${researchType}"]`).textContent;

      const data = {
        studentName,
        studentPhone,
        researchTitle,
        pages,
        deliveryDate,
        stage: stageText,
        researchType: researchTypeText,
        cost: cost.toFixed(2),
        orderId
      };

      // Send to WhatsApp immediately
      sendToWhatsApp();

      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbwscrLSpHV2VPXPxm7IhR0cDuSMDGCh1ji1m5YwEzFGNLkCe3Xv162yzrIS-UQ9LJCzTQ/exec', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await response.json();
        if (result.status === 'success') {
          alert(currentLang === 'ar' ? 'تم إرسال الطلب بنجاح إلى Google Sheets وWhatsApp!' : 'Order successfully sent to Google Sheets and WhatsApp!');
        } else {
          alert(currentLang === 'ar' ? 'حدث خطأ أثناء إرسال الطلب إلى Google Sheets: ' + result.message : 'Error sending order to Google Sheets: ' + result.message);
        }
      } catch (error) {
        alert(currentLang === 'ar' ? 'حدث خطأ أثناء الاتصال بـ Google Sheets: ' + error.message + '\nتأكد من استضافة الصفحة على خادم (مثل GitHub Pages) لتجنب مشاكل CORS.' : 'Error connecting to Google Sheets: ' + error.message + '\nEnsure the page is hosted on a server (e.g., GitHub Pages) to avoid CORS issues.');
      }

      // Reset form
      document.getElementById('studentName').value = '';
      document.getElementById('studentPhone').value = '';
      document.getElementById('researchTitle').value = '';
      document.getElementById('stage').value = '';
      document.getElementById('researchType').value = '';
      document.getElementById('pages').value = '';
      document.getElementById('deliveryDate').value = '';
      document.getElementById('language').value = 'arabic';
      document.getElementById('result').innerHTML = '';
      document.getElementById('sendWhatsApp').classList.add('hidden');
      document.getElementById('orderPreview').classList.add('hidden');
    }

    function sendToWhatsApp() {
      const { studentName, studentPhone, researchTitle, stage, researchType, pages, deliveryDate, language, cost, orderId } = orderDetails;
      const stageText = document.querySelector(`#stage option[value="${stage}"]`).textContent;
      const researchTypeText = document.querySelector(`#researchType option[value="${researchType}"]`).textContent;
      const languageText = document.querySelector(`#language option[value="${language}"]`).textContent;

      const message = `${currentLang === 'ar' ? 'طلب بحث مخصص' : 'Custom Research Request'}:\n` +
                      `${currentLang === 'ar' ? 'معرف الطلب' : 'Order ID'}: ${orderId}\n` +
                      `${translations[currentLang].studentNameLabel} ${studentName}\n` +
                      `${translations[currentLang].studentPhoneLabel} ${studentPhone}\n` +
                      `${translations[currentLang].researchTitleLabel} ${researchTitle}\n` +
                      `${translations[currentLang].stageLabel} ${stageText}\n` +
                      `${translations[currentLang].researchTypeLabel} ${researchTypeText}\n` +
                      `${translations[currentLang].pagesLabel} ${pages}\n` +
                      `${translations[currentLang].deliveryDateLabel} ${deliveryDate}\n` +
                      `${translations[currentLang].languageLabel} ${languageText}\n` +
                      `${translations[currentLang].calculateBtn}: ${cost.toFixed(2)} EGP`;

      const phoneNumber = '201022679250';
      const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');

      // Save order to localStorage
      const orders = JSON.parse(localStorage.getItem('orders') || '[]');
      orders.push({ ...orderDetails, orderId });
      localStorage.setItem('orders', JSON.stringify(orders));
    }

    function trackOrder() {
      const orderId = document.getElementById('trackOrderId').value.trim();
      const trackResult = document.getElementById('trackResult');
      
      if (!orderId) {
        trackResult.innerHTML = `<span class="text-red-500">${currentLang === 'ar' ? 'الرجاء إدخال معرف الطلب!' : 'Please enter the Order ID!'}</span>`;
        return;
      }

      const orders = JSON.parse(localStorage.getItem('orders') || '[]');
      const order = orders.find(o => o.orderId === orderId);

      if (order) {
        const stageText = document.querySelector(`#stage option[value="${order.stage}"]`).textContent;
        const researchTypeText = document.querySelector(`#researchType option[value="${order.researchType}"]`).textContent;
        const languageText = document.querySelector(`#language option[value="${order.language}"]`).textContent;

        trackResult.innerHTML = `
          <div class="bg-gray-100 p-4 rounded-lg">
            <p><strong>${currentLang === 'ar' ? 'معرف الطلب' : 'Order ID'}:</strong> ${order.orderId}</p>
            <p><strong>${currentLang === 'ar' ? 'الحالة' : 'Status'}:</strong> ${order.status}</p>
            <p><strong>${translations[currentLang].studentNameLabel}</strong> ${order.studentName}</p>
            <p><strong>${translations[currentLang].researchTitleLabel}</strong> ${order.researchTitle}</p>
            <p><strong>${translations[currentLang].stageLabel}</strong> ${stageText}</p>
            <p><strong>${translations[currentLang].researchTypeLabel}</strong> ${researchTypeText}</p>
            <p><strong>${translations[currentLang].pagesLabel}</strong> ${order.pages}</p>
            <p><strong>${translations[currentLang].deliveryDateLabel}</strong> ${order.deliveryDate}</p>
            <p><strong>${translations[currentLang].languageLabel}</strong> ${languageText}</p>
            <p><strong>${translations[currentLang].calculateBtn}:</strong> ${order.cost.toFixed(2)} EGP</p>
          </div>
        `;
      } else {
        trackResult.innerHTML = `<span class="text-red-500">${currentLang === 'ar' ? 'لم يتم العثور على الطلب!' : 'Order not found!'}</span>`;
      }
    }
  </script>
</body>
</html>
